!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):"object"==typeof exports?exports.pagelet=b():a.pagelet=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a){"use strict";function b(a,b,d){var e,g="js"===b,h="css"===b,i=m.createElement(g?"script":"link"),j="onload"in i,k=setTimeout(function(){clearTimeout(k),clearInterval(e),d("timeout")},q);g?(i.type="text/javascript",i.async="async",i.src=a):(h&&(i.type="text/css",i.rel="stylesheet"),i.href=a),i.onload=i.onreadystatechange=function(){!i||i.readyState&&!/loaded|complete/.test(i.readyState)||(clearTimeout(k),i.onload=i.onreadystatechange=c,g&&p&&i.parentNode&&p.removeChild(i),d(),i=null)},i.onerror=function(b){clearTimeout(k),clearInterval(e),b=(b||{}).error||new Error("load resource timeout"),b.message="Error loading ["+a+"]: "+b.message,d(b)},f(p,i),h&&(o||!j)&&(e=setInterval(function(){i.sheet&&(clearTimeout(id),clearInterval(e),d())},20))}function c(){}function d(a){return!!a}function e(a,b){return a.getAttribute(b)}function f(a,b){return a.appendChild(b)}function g(a,b,c){if(b&&b.length&&(b=b.filter(function(a){var b=k[a]===!0;return k[a]=!0,!b}),b.length))if(r){var d=b.join(",");a.push({uri:t.replace("%s",d),type:c})}else b.forEach(function(b){a.push({uri:b,type:c})})}function h(a,b){return Object.prototype.toString.call(a)==="[Object "+b+"]"}function i(a){var b=m.createElement("script");f(b,m.createTextNode(a)),f(p,b)}var j=window,k={},l=navigator.userAgent,m=document,n=j.history,o=+l.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,p=m.head||m.getElementsByTagName("head")[0],q=6e4,r=!1,s="/co??%s",t=s,u=n&&n.pushState&&n.replaceState&&!l.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),v={};v.init=function(a,b,c){r=!!a,t=b||s,c&&c.length&&c.forEach(function(a){k[a]=!0})};var w,x;v.load=function(a,d,e,f){if(d&&d.length){e=e||c,f=f||c,h(d,"String")&&(d=d.split(/\s*,\s*/)),d=d.join(",");var k=a+(-1===a.indexOf("?")?"?":"&")+"pagelets="+encodeURIComponent(d);w&&w.readyState<4&&(w.onreadystatechange=c,w.abort()),w=new j.XMLHttpRequest,w.onprogress=f,w.onreadystatechange=function(){if(4==w.readyState){w.onreadystatechange=c;var a,d=null;if(w.status>=200&&w.status<300||304==w.status){a=w.responseText;try{a=JSON.parse(a)}catch(f){d=f}if(d)e(d);else{m.title=a.title||m.title;var h=[];g(h,a.js,"js"),g(h,a.css,"css");var j=function(){if(a.script&&a.script.length){var b="!function(){",d="}();\n",e=b+a.script.join(d+b)+d;i(e)}j=c};if(h&&h.length){var k=h.length;h.forEach(function(c){b(c.uri,c.type,function(b){k--,0===k&&e(d,a,j),d=b})})}else e(d,a,j)}}else e(w.statusText||(w.status?"error":"abort"))}},w.open("GET",k,!0),w.send()}else location.href=a},v.go=function(a,b,c,d){u&&b?(x||(x={url:j.location.href,title:m.title},n.replaceState(x,m.title)),v.load(a,b,function(b,d,e){var f=d.title||m.title;x={url:a,title:f},n.replaceState(x,f,a);try{m.activeElement.blur()}catch(g){}c(null,d.html)!==!1&&e()},d),w.readyState>0&&n.pushState(null,"",a)):location.href=a},v.autoload=function(){j.addEventListener("popstate",function(a){x=a.state,x&&(location.href=x.url)},!1),m.docmElement.addEventListener("click",function(a){var b=a.target;if("a"===b.tagName.toLowerCase()){if(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return;if(location.protocol!==b.protocol||location.hostname!==b.hostname)return;var c=e(b,"data-pagelets"),f=e(b,"data-parents"),g=e(b,"data-autocache"),h=e(b,"href");if(c=(c||"").split(/\s*,\s*/).filter(d),f=(f||"").split(/\s*,\s*/).filter(d),h&&f.length===c.length&&c.length>0){if(a.preventDefault(),a.stopPropagation(),"cached"===g)return!1;"false"===g&&(h+=(h.indexOf("?")>=0?"&":"?")+"_ts="+Date.now());var i={};c.forEach(function(a,b){i[a]=f[b]}),v.go(h,c,function(a,c){if(a)throw new Error(a);for(var d in c)if(c.hasOwnProperty(d)&&i.hasOwnProperty(d)){var e=i[d],f=m.getElementById(e);if(!f)throw new Error("undefined parent dom ["+e+"]");f.innerHTML=c[d],f=null,"true"===g&&b.setAttribute("data-autocache","cached")}})}}},!1)},a.exports=v}])});