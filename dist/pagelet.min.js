!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):"object"==typeof exports?exports.pagelet=b():a.pagelet=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a,b,c){if(b&&b.length&&(b=b.filter(function(a){var b=r[a]===!0;return r[a]=!0,!b}),b.length))if(q){var d=b.join(",");a.push({uri:p.replace("%s",d),type:c})}else b.forEach(function(b){a.push({uri:b,type:c})})}function e(){}function f(a){var b=n.createElement("script");h(b,n.createTextNode(a)),h($head,b)}function g(a){return!!a}function h(a,b){return a.appendChild(b)}function i(a,b){return a.hasOwnProperty(b)}function j(a,b){return a.getAttribute(b)}function k(a,b){return Object.prototype.toString.call(a)==="[Object "+b+"]"}var l=window,m=l.history,n=document,o="/co??%s",p=o,q=!1,r={},s=c(1),t=m&&m.pushState&&m.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),u={};u.init=function(a,b,c){q=!!a,p=b||o,c&&c.length&&c.forEach(function(a){r[a]=!0})};var v;u.load=function(a,b,c,g){if(b&&b.length){c=c||e,g=g||e,k(b,"String")&&(b=b.split(/\s*,\s*/)),b=b.join(",");var h=a+(-1===a.indexOf("?")?"?":"&")+"pagelets="+encodeURIComponent(b);s.request(h,function(a,b){if(a)return c(a);n.title=b.title||n.title;var g=[];d(g,b.js,"js"),d(g,b.css,"css");var h=function(){if(b.script&&b.script.length){var a="!function(){",c="}();\n",d=a+b.script.join(c+a)+c;f(d)}h=e},i=a;if(g&&g.length){var j=g.length;g.forEach(function(a){s(a.uri,a.type,function(a){j--,0===j&&c(i,b,h),i=a})})}else c(i,b,h)},g)}else location.href=a},u.go=function(a,b,c,d){if(t&&b){v||(v={url:l.location.href,title:n.title},m.replaceState(v,n.title)),u.load(a,b,function(b,d,e){var f=d.title||n.title;v={url:a,title:f},m.replaceState(v,f,a);try{n.activeElement.blur()}catch(g){}c(null,d.html)!==!1&&e()},d);var e=s.xhr();e&&e.readyState>0&&m.pushState(null,"",a)}else location.href=a},u.autoload=function(){l.addEventListener("popstate",function(a){v=a.state,v&&(location.href=v.url)},!1),n.documentElement.addEventListener("click",function(a){var b=a.target;if("a"===b.tagName.toLowerCase()){if(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return;if(location.protocol!==b.protocol||location.hostname!==b.hostname)return;var c=j(b,"data-pagelets"),d=j(b,"data-parents"),e=j(b,"data-autocache"),f=j(b,"href");if(c=(c||"").split(/\s*,\s*/).filter(g),d=(d||"").split(/\s*,\s*/).filter(g),f&&d.length===c.length&&c.length>0){if(a.preventDefault(),a.stopPropagation(),"cached"===e)return!1;"false"===e&&(f+=(f.indexOf("?")>=0?"&":"?")+"_ts="+Date.now());var h={};c.forEach(function(a,b){h[a]=d[b]}),u.go(f,c,function(a,c){if(a)throw new Error(a);for(var d in c)if(i(c,d)&&i(h,d)){var f=h[d],g=n.getElementById(f);if(!g)throw new Error("undefined parent dom ["+f+"]");g=null,"true"===e&&b.setAttribute("data-autocache","cached")}})}}},!1)};var w={};u.on=function(a,b){var c=w[a];!c&&(c=w[a]=[]),!~c.indexOf(b)&&c.push(b)},u.off=function(a,b){if(arguments.length>=2)w[a]=null;else{var c=w[a];if(!c)return;var d,e=[];w[a]=c.forEach(function(a){a===b?d=!0:e.push(a)}),d&&(w[a]=e)}return this},a.exports=u},function(a,b){(function(b){function c(){}function d(a,b,d){var e,l="js"===b,m="css"===b,n=j.createElement(l?"script":"link"),o="onload"in n,p=setTimeout(function(){clearTimeout(p),clearInterval(e),d("timeout")},i);l?(n.type="text/javascript",n.async="async",n.src=a):(m&&(n.type="text/css",n.rel="stylesheet"),n.href=a),n.onload=n[g]=function(){!n||n[h]&&!/loaded|complete/.test(n[h])||(clearTimeout(p),n.onload=n[g]=c,l&&k&&n.parentNode&&k.removeChild(n),d(),n=null)},n.onerror=function(b){clearTimeout(p),clearInterval(e),b=(b||{}).error||new Error("load resource timeout"),b.message="Error loading ["+a+"]: "+b.message,d(b)},k.appendChild(n),m&&(f||!o)&&(e=setInterval(function(){n.sheet&&(clearTimeout(id),clearInterval(e),d())},20))}var e,f=+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,g="onreadystatechange",h="readyState",i=6e4,j=document,k=j.head||j.getElementsByTagName("head")[0];d.xhr=function(){return e},d.request=function(a,d,f){e&&e[h]<4&&(e[g]=c,e.abort()),e=new b.XMLHttpRequest,e.onprogress=f,e[g]=function(){if(4==e[h]){e[g]=c;var a,b=null;if(e.status>=200&&e.status<300||304==e.status){a=e.responseText;try{a=JSON.parse(a)}catch(f){b=f}b?d(b):d(null,a)}else d(e.statusText||(e.status?"error":"abort"))}},e.open("GET",a,!0),e.send()},a.exports=d}).call(b,function(){return this}())}])});