!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):"object"==typeof exports?exports.pagelet=b():a.pagelet=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a.exports=c(1)},function(a){"use strict";function b(a,b,c){var e,f="js"===b,g="css"===b,h=document.createElement(f?"script":"link"),i="onload"in h,j=setTimeout(function(){clearTimeout(j),clearInterval(e),c("timeout")},o);f?(h.type="text/javascript",h.async="async",h.src=a):(g&&(h.type="text/css",h.rel="stylesheet"),h.href=a),h.onload=h.onreadystatechange=function(){!h||h.readyState&&!/loaded|complete/.test(h.readyState)||(clearTimeout(j),h.onload=h.onreadystatechange=d,f&&n&&h.parentNode&&n.removeChild(h),c(),h=null)},h.onerror=function(b){clearTimeout(j),clearInterval(e),b=(b||{}).error||new Error("load resource timeout"),b.message="Error loading ["+a+"]: "+b.message,c(b)},n.appendChild(h),g&&(m||!i)&&(e=setInterval(function(){h.sheet&&(clearTimeout(id),clearInterval(e),c())},20))}function c(a,b){return Object.prototype.toString.call(a)==="[Object "+b+"]"}function d(){}function e(a){return!!a}function f(a,b){return a.getAttribute(b)}function g(a,b,c){if(b&&b.length&&(b=b.filter(function(a){var b=j[a]===!0;return j[a]=!0,!b}),b.length))if(p){var d=b.join(",");a.push({uri:r.replace("%s",d),type:c})}else b.forEach(function(b){a.push({uri:b,type:c})})}function h(a){var b=document.createElement("script");b.appendChild(document.createTextNode(a)),n.appendChild(b)}var i=window,j={},k=navigator.userAgent,l=i.history,m=+k.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,n=document.head||document.getElementsByTagName("head")[0],o=6e4,p=!1,q="/co??%s",r=q,s=l&&l.pushState&&l.replaceState&&!k.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),t={};t.init=function(a,b,c){p=!!a,r=b||q,c&&c.length&&c.forEach(function(a){j[a]=!0})};var u,v;t.load=function(a,e,f,j){if(e&&e.length){f=f||d,j=j||d,c(e,"String")&&(e=e.split(/\s*,\s*/)),e=e.join(",");var k=a+(-1===a.indexOf("?")?"?":"&")+"pagelets="+encodeURIComponent(e);u&&u.readyState<4&&(u.onreadystatechange=d,u.abort()),u=new i.XMLHttpRequest,u.onprogress=j,u.onreadystatechange=function(){if(4==u.readyState){u.onreadystatechange=d;var a,c=null;if(u.status>=200&&u.status<300||304==u.status){a=u.responseText;try{a=JSON.parse(a)}catch(e){c=e}if(c)f(c);else{document.title=a.title||document.title;var i=[];g(i,a.js,"js"),g(i,a.css,"css");var j=function(){if(a.script&&a.script.length){var b="!function(){",c="}();\n",e=b+a.script.join(c+b)+c;h(e)}j=d};if(i&&i.length){var k=i.length;i.forEach(function(d){b(d.uri,d.type,function(b){k--,0===k&&f(c,a,j),c=b})})}else f(c,a,j)}}else f(u.statusText||(u.status?"error":"abort"))}},u.open("GET",k,!0),u.send()}else location.href=a},t.go=function(a,b,c,d){s&&b?(v||(v={url:i.location.href,title:document.title},l.replaceState(v,document.title)),t.load(a,b,function(b,d,e){var f=d.title||document.title;v={url:a,title:f},l.replaceState(v,f,a);try{document.activeElement.blur()}catch(g){}c(null,d.html)!==!1&&e()},d),u.readyState>0&&l.pushState(null,"",a)):location.href=a},t.autoload=function(){i.addEventListener("popstate",function(a){v=a.state,v&&(location.href=v.url)},!1),document.documentElement.addEventListener("click",function(a){var b=a.target;if("a"===b.tagName.toLowerCase()){if(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return;if(location.protocol!==b.protocol||location.hostname!==b.hostname)return;var c=f(b,"data-pagelets"),d=f(b,"data-parents"),g=f(b,"data-autocache"),h=f(b,"href");if(c=(c||"").split(/\s*,\s*/).filter(e),d=(d||"").split(/\s*,\s*/).filter(e),h&&d.length===c.length&&c.length>0){if(a.preventDefault(),a.stopPropagation(),"cached"===g)return!1;"false"===g&&(h+=(h.indexOf("?")>=0?"&":"?")+"_ts="+Date.now());var i={};c.forEach(function(a,b){i[a]=d[b]}),t.go(h,c,function(a,c){if(a)throw new Error(a);for(var d in c)if(c.hasOwnProperty(d)&&i.hasOwnProperty(d)){var e=i[d],f=document.getElementById(e);if(!f)throw new Error("undefined parent dom ["+e+"]");f.innerHTML=c[d],f=null,"true"===g&&b.setAttribute("data-autocache","cached")}})}}},!1)},a.exports=t}])});