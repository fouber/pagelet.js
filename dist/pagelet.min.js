!function(a){"use strict";function b(){}function c(a){var b=document.createElement("script");e(b,document.createTextNode(a)),e(document.head,b)}function d(a){return!!a}function e(a,b){return a.appendChild(b)}function f(a,b){return Object.prototype.toString.call(a).toLowerCase()==="[object "+b+"]"}function g(a,c,d){var f,g="js"===c,h="css"===c,i=document.createElement(g?"script":"link"),j="onload"in i,k=setTimeout(function(){clearTimeout(k),clearInterval(f),d("timeout")},p);g?(i.type="text/javascript",i.async="async",i.src=a):(h&&(i.type="text/css",i.rel="stylesheet"),i.href=a),i.onload=i[n]=function(){!i||i[o]&&!/loaded|complete/.test(i[o])||(clearTimeout(k),i.onload=i[n]=b,g&&s&&i.parentNode&&s.removeChild(i),d(),i=null)},i.onerror=function(b){clearTimeout(k),clearInterval(f),b=(b||{}).error||new Error("load resource timeout"),b.message="Error loading ["+a+"]: "+b.message,d(b)},e(s,i),h&&(r||!j)&&(f=setInterval(function(){i.sheet&&(clearTimeout(id),clearInterval(f),d())},20))}function h(a){for(var b={},c=0;c<u.length;c++)b[u[c]]={};a.emit=function(c,d){var e=d.replace(/(\?.*)/,""),f=b[c];for(var g in f){var h=f[g].routeData.route_reg,i=new RegExp(h),j=e.match(i);if(null!=j){for(var k=f[g].fn,l=f[g].routeData.params_count,m=[],n=1;l>=n;n++)j[n]&&m.push(j[n]);var o=[].slice.call(arguments);return o.shift(),o.push(m),k.apply(a,o)}}return!1},a.on=function(a,c,d){var e=b[a][c];e||(e=b[a][c]={},e.fn=d,e.routeData=i(c))}}function i(a){var b=/\(.+\)/g,c=/:\w+\/?/g,d=a.split(":").length-1,e=a.replace(c,function(a){var b="{[^/]+}",c=-1!=a.indexOf("/");return c&&(b+="/"),b});e=e.replace(b,function(a){var b=a.replace("(","(?:").replace(")","|)");return b});var e=e.replace("*",".*"),f=/{/g;e=e.replace(f,"(");var f=/}/g;e=e.replace(f,")");var f=/\//g;return e=e.replace(f,"\\/"),e+="$",{route_reg:e,route:a,params_count:d}}function j(a,d,e){document.title=a.title||document.title;var f=[],h=null;l(f,a.js,"js"),l(f,a.css,"css");var i=function(){if(a.script&&a.script.length){var d="!function(){",e="}();\n",f=d+a.script.join(e+d)+e;c(f)}i=b};if(f&&f.length){var j=f.length;f.forEach(function(b){g(b.uri,b.type,function(b){j--,0===j&&d(h,a,i,{fromCache:e}),h=b})})}else d(h,a,i,{fromCache:e})}function k(a,b,c,d){try{document.activeElement.blur()}catch(e){}if(a)throw new Error(a);if("block"!=y.emit("beforeDomReplace",c,b,d)){for(var f in b)if(b.hasOwnProperty(f)){var g=document.createElement("div");g.innerHTML=b[f];var h=document.getElementById(f);h.innerHTML=g.childNodes[0].innerHTML}d()}}function l(a,b,c){if(b&&b.length&&(b=b.filter(function(a){var b=z[a]===!0;return z[a]=!0,!b}),b.length))if(A){var d=b.join(",");a.push({uri:C.replace("%s",d),type:c})}else b.forEach(function(b){a.push({uri:b,type:c})})}var m,n="onreadystatechange",o="readyState",p=6e4,q="/co??%s",r=+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,s=document.head||document.getElementsByTagName("head")[0];g.xhr=function(){return m},g.request=function(c,d,e,f){var g=d.before||b,h=d.pagelets||!1;m&&m[o]<4&&(m[n]=b,m.abort()),m=new a.XMLHttpRequest,m.onprogress=f,m[n]=function(){if(4==m[o]){m[n]=b;var a,c=null;if(m.status>=200&&m.status<300||304==m.status){a=m.responseText;try{a=JSON.parse(a)}catch(d){c=d}c?e(c):e(null,a)}else c=m.statusText||(m.status?"error":"abort"),e(c)}},g(m),m.open("GET",c,!0),m.setRequestHeader("scrat-pagelets",h),m.send()};var t,u=["beforeload","beforeDomReplace"],v=[],w=100,x={set:function(a,b){v.length>=w&&v.shift(),v.push({key:a,val:b})},get:function(a){for(var b=v.length-1;b>=0;b--)if(v[b].key==a)return v[b].val;return!1}},y=a.pagelet={},z={},A=!1,B=!0,C=q,D=a.history&&a.history.pushState&&a.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),E=!0,F={};h(y),y.stop=function(){E=!1},y.init=function(a,b,c){A=!!a,C=b||q,c&&c.length&&c.forEach(function(a){z[a]=!0})},y.addQuery=function(a){F=a},y.initState=function(b,c){var b=b||[],c=c||{};t||(t={url:a.location.href,title:document.title,pagelets:b,pageletOptions:c},a.history.replaceState(t,document.title))},y.go=function(b,c,d){var e=Boolean(d.stateReplace)||!1;if(D&&c&&y.initState(),"block"!=y.emit("beforeload",b,c)){y.load(b,c,d,function(e,f,g,h){if(e)throw new Error(e);var i=f.title||document.title,j={url:b,title:i,pagelets:c,pageletOptions:d};h&&h.fromCache?a.history.pushState(j,i,b):a.history.replaceState(j,i,b),k(e,f.html,b,g)});var f=g.xhr();f.readyState>0&&4!=f.readyState&&(e?a.history.replaceState(null,"",b):a.history.pushState(null,"",b))}else{var h={url:b,pagelets:c,pageletOptions:d};e?a.history.replaceState(h,"",b):a.history.pushState(h,"",b)}},y.load=function(a,c,d,e){if(c&&c.length){e=e||b,f(c,"String")&&(c=c.split(/\s*,\s*/)),c=c.join(",");var h=Boolean(d.nocache)||!1;if(B&&!h){var i=x.get(a+"-"+c);if(i)return void j(i,e,!0)}var k=a+(-1===a.indexOf("?")?"?":"&")+"pagelets="+encodeURIComponent(c);for(var l in F)-1===a.indexOf(l)&&(k+="&"+l+"="+encodeURIComponent(F[l]));g.request(k,{pagelets:c,before:function(a){}},function(b,d){return b?e(b):(B&&x.set(a+"-"+c,d),void j(d,e,!1))})}else location.href=a},document.documentElement.addEventListener("click",function(a){if(E)for(var b=a.target;b&&b.tagName&&"body"!=b.tagName.toLowerCase();){if("a"===b.tagName.toLowerCase()){var c=b.getAttribute("href"),e=(b.getAttribute("data-pagelets")||"").split(/\s*,\s*/).filter(d),f=b.getAttribute("data-pagelets-stateReplace")||!1,g=b.getAttribute("data-pagelets-nocache")||!1;if(c&&e.length>0){a.preventDefault(),a.stopPropagation();var h={stateReplace:f,nocache:g};y.go(c,e,h)}break}b=b.parentNode}}),a.addEventListener("popstate",function(a){var b=a.state;if(!b)return void(location.href=b.url);var c=b.url,d=b.pagelets;"block"!=y.emit("beforeload",c,d)&&y.load(c,d,b.pageletOptions,function(a,c,d){k(a,c.html,b.url,d)})},!1)}(window);